<script type="text/javascript">
    var changeDate = function (date) {
        var firstDay = new Date(date);
        setDropDownValue(firstDay);
        monthReportDashboard.resetDates(firstDay, new Date(firstDay.getFullYear(), firstDay.getMonth() + 1, 0));
    }

    var setDropDownValue = function (date) {
        $("#month_dropdown").text((date.getFullYear() + " " + date.getMonthLabel() + " ")).append($('<span>').attr('class', 'caret'));
    }

    var startDate = new Date(RAW_DATA_FIRST_ENTRY);
    var currentDate = new Date();
    currentDate.setDate(currentDate.getDate() - 15);

    var monthReportDashboardConfig = {
        date: {
            start: new Date(currentDate.getFullYear(), currentDate.getMonth(), 1),
            end: new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0),
        },
        titleSuffix: {
            id: 'monthly_report_title_suffix'
        },
        cumulativeFlowChart: {
            id: 'monthly_report_extract_cumulative_chart',
            height: 600
        },
        durationStats: 'monthly_report_duration_stats',
        tasksList: 'monthly_report_tasks_list'
    };

    var monthReportDashboard = new ReportDashboard(monthReportDashboardConfig);
    setDropDownValue(currentDate);

    // Initializing Month Picker
    while (startDate < currentDate) {
        $('#monthSelector').append($('<option>').text(currentDate.getFullYear() + " " + currentDate.getMonthLabel()).attr('value', currentDate.getFullYear() + "-" + (currentDate.getMonth() + 1)));
        $('#month_dropdown_list').append($('<li>').append($('<a>').text(currentDate.getFullYear() + " " + currentDate.getMonthLabel()).attr('onClick', 'changeDate(\'' + currentDate.getFullYear() + "-" + (currentDate.getMonth() + 1) + '\');').attr('href', '#')));
        currentDate.setMonth(currentDate.getMonth() - 1);
    }

    generateToggleFilter("monthly_report_switch", monthReportDashboard);

    registerDashboard("#tab_monthly_report_view", monthReportDashboard);
</script>

<div class="card to-print graph">
    <div class="row">
        <h2 class="col-md-12 card-title">
            <img class="print-only" src="../../img/team-traffic.png"/> Team Traffic - Cycle time -
            <div id="month_selector" class="dropdown">
                <button id="month_dropdown" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"> Dropdown <span class="caret"></span></button>
                <ul id="month_dropdown_list" class="dropdown-menu" aria-labelledby="month_dropdown"></ul>
            </div>
            <span id="monthly_report_title_suffix"></span>
            <div class="not-to-print pull-right">
                <div id="monthly_report_switch" class="switch"></div>
                <a href="#"><span class="glyphicon glyphicon-th-list" data-toggle="modal" data-target="#monthly_report_tasks_list_modal"></span></a>
            </div>
        </h2>
    </div>
    <div class="row card-relative-chart">
        <div id="monthly_report_extract_cumulative_chart"></div>
        <div class="card to-print stats">
            <div id="monthly_report_duration_stats"></div>
        </div>
    </div>
</div>

<div id="monthly_report_tasks_list_modal" class="modal ticket-list fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Tasks list</h4>
            </div>
            <div class="modal-body">
                <div id="monthly_report_tasks_list" class="col-md-12"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>